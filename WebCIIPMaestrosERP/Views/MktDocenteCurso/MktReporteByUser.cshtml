@using WebCIIPMaestrosERP.Models;
@model MktDocenteCursoCLS

@{
}

@using (Ajax.BeginForm("Filters", "", new AjaxOptions
{
    HttpMethod = "POST",
    UpdateTargetId = "partialTab",
    InsertionMode = InsertionMode.Replace
}, new { @id = "frmFilters" }))
{
    <div class="panel panel-success">
        <div class="panel-heading">
            <form class="navbar-form navbar-left">
                <table>
                    <tr>
                        <td>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="glyphicon glyphicon-th btn-lg" aria-hidden="true"></span></td>
                        <td><span class="glyphicon glyphicon-th-list btn-lg" aria-hidden="true"></span></td>
                        <td>Usuario Marketing</td>
                        @Html.Hidden("page", null, new { @id = "optPage" })
                        <td>
                            @Html.DropDownList("UserId", new SelectList(""), "Todos", new { @class = "form-control", @id = "User" })
                        </td>
                        <td>Cursos</td>
                        <td>
                            @Html.DropDownList("CursId", new SelectList(""), "Todos", new { @class = "form-control", @id = "Curso" })
                        </td>
                        <td>Fecha de Curso</td>
                        <td>
                            @Html.DropDownList("LanId", new SelectList(""), "Todos", new { @class = "form-control", @id = "Lanzamiento" })
                        </td>
                        <td>
                            <input type="submit" value="Buscar" class="btn btn-success" />
                        </td>
                        <td>
                            &nbsp;
                        </td>
                        <td>@Html.ActionLink(" ", "generarExcel", "MktDocenteCurso", null, new { @class = "btn btn-success glyphicon glyphicon-save form-control", @target = "_blank" })</td>
                        <td>
                            <p>&nbsp&nbsp&nbsp</p>
                        </td>
                        <td>
                            Total de Registros recuperados: @ViewBag.ContarDocentesCapturados
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <div class="panel-body"></div>
        <div id="partialTab">
            @Html.Partial("_MktReporteByUser", Model)
        </div>
    </div>
}

@section Scripts{
    
    <script>
        $(document).ready(function () {

            $.get("@Url.Action("GetDocentes", "MktDocenteCurso")", function (ListaUsuMkt) {
                $("#User").html("");
                $("#User").append('<option value="0">Todos</option>');
                $("#Curso").attr("disabled", true);
                $("#Lanzamiento").attr("disabled", true);
                    $.each(ListaUsuMkt, function (index, item) {
                        $("#User").append('<option value="' + item.Value + '">' + item.Text + '</option>');
                    });
            });
        });

        $("#User").change(function () {
                var text = $(this).children("option:selected").text();
                var val = $(this).children("option:selected").val();
                if (text == "Todos") {
                    $("#Curso").html("");
                    $("#Curso").attr("disabled", true);
                    $("#Curso").append('<option value="0" >Todos</option>');
                    $("#Lanzamiento").html("");
                    $("#Lanzamiento").attr("disabled", true);
                    $("#Lanzamiento").append('<option value="0" >Todos</option>');
                } else {
                    $.get("@Url.Action("GetCursosByDoc", "MktDocenteCurso")?id=" + parseFloat(val), function (ListaCursos) {
                        $("#Curso").html("");
                        $("#Curso").append('<option value="0">Todos</option>');
                        $("#Curso").attr("disabled", false);
                        $.each(ListaCursos, function (index, item) {
                            $("#Curso").append('<option value="' + item.Value + '">' + item.Text + '</option>');
                        });
                    });
                }
        });

        $("#Curso").change(function () {
                var Uval = $(User).children("option:selected").val();
                var text = $(this).children("option:selected").text();
                var val = $(this).children("option:selected").val();
                if (text == "Todos") {
                    $("#Lanzamiento").html("");
                    $("#Lanzamiento").attr("disabled", true);
                    $("#Lanzamiento").append('<option value="0" >Todos</option>');
                } else {
                    $.get("@Url.Action("GetLanzamientoByCurso", "MktDocenteCurso")?id=" + parseFloat(Uval) + "&IdCurso=" + val, function (Lanzamientos) {
                        $("#Lanzamiento").html("");
                        $("#Lanzamiento").append('<option value="0">Todos</option>');
                        $("#Lanzamiento").attr("disabled", false);
                        $.each(Lanzamientos, function (index, item) {
                            $("#Lanzamiento").append('<option value="' + item.Value + '">' + item.Text + '</option>');
                        });
                    });
                }
        });

        $(document).on('click', '.pagerNum', function (e) {
            var page = $(this).data('codigo');
            document.getElementById("optPage").value = page;
            $("#frmFilters").trigger("submit");
            document.getElementById("optPage").value = "";
        });
    </script>
    }
