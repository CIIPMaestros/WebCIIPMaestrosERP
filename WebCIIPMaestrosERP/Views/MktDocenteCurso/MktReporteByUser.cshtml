@using WebCIIPMaestrosERP.Models;
@model List<MktDocenteCursoCLS>



@{

    List<SelectListItem> CargaCursos = (List<SelectListItem>)ViewBag.CargaCursos;
    List<SelectListItem> CargaUsuMktAll = (List<SelectListItem>)ViewBag.CargaUsuMktAll;

    //guardamos las varialbes de los combos para la recarga del mismo.
    string varSubDominio = System.Configuration.ConfigurationManager.AppSettings["SubDominio"];
    

}


<br>
<br>
@using (Html.BeginForm("MktReporteByUser", "MktDocenteCurso", FormMethod.Get))
{

    @Html.Hidden("IdCurso")
    @Html.Hidden("IdLanzamiento")


    <div class="panel panel-success">
        <!-- Default panel contents -->
        <div class="panel-heading">
            <table>
                <tr>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td><span class="glyphicon glyphicon-th btn-lg" aria-hidden="true"></span></td>
                    <td><span class="glyphicon glyphicon-th-list btn-lg" aria-hidden="true"></span></td>
                    <td>Usuario Marketing</td>

                    <td>
                        @Html.DropDownList("USU_ID", CargaUsuMktAll, new { @class = "form-control" })


                    </td>


                    <td>Cursos</td>

                    <td>



                        <select id="CUR_ID" name="CUR_ID" class="form-control">
                            <!-- Opciones de la lista -->
                            <option value="0">Todos</option>
                        </select>


                    </td>



                    <td>Fecha de Curso</td>

                    <td>

                        <select id="LAN_ID" name="LAN_ID" onchange="ShowSelectedLan();" class="form-control">
                            <!-- Opciones de la lista -->
                            <option value="0">Todos</option>
                        </select>


                    </td>

                    <td>
                        <input type="submit" value="Buscar" class="btn btn-success" />
                    </td>

                    <td>
                        &nbsp;
                    </td>


                    <td>@Html.ActionLink(" ", "generarExcel", "MktDocenteCurso", null, new { @class = "btn btn-success glyphicon glyphicon-save form-control", @target = "_blank" })</td>

                    <td>
                        <p>&nbsp&nbsp&nbsp</p>
                    </td>

                    <td>
                        Total de Registros recuperados: @ViewBag.ContarDocentesCapturados
                    </td>






                </tr>
            </table>
        </div>
        <div class="panel-body">
            <p></p>
        </div>




        <!-- Table -->
        <table class="table border-bottom table-hover">

            <thead>
                <tr>
                    <td>@Html.LabelFor(p => Model[0].DOC_ID)</td>
                    <td>@Html.LabelFor(p => Model[0].DOC_NOMBRES)</td>
                    <td>@Html.LabelFor(p => Model[0].DOC_APELLIDOS)</td>
                    <td>@Html.LabelFor(p => Model[0].DOC_EMAIL)</td>
                    <td>@Html.LabelFor(p => Model[0].DOC_CELULAR)</td>
                    <td>@Html.LabelFor(p => Model[0].CUR_NOMBRE)</td>
                    <td>@Html.LabelFor(p => Model[0].DCU_FEC)</td>



                </tr>
            <thead>
            <tbody>
                @foreach (var item in Model)
                {
                <tr>
                    <td>@item.DOC_ID</td>
                    <td>@item.DOC_NOMBRES</td>
                    <td>@item.DOC_APELLIDOS</td>
                    <td>@item.DOC_EMAIL</td>
                    <td>@item.DOC_CELULAR</td>
                    <td>@item.CUR_NOMBRE</td>
                    <td>@item.DCU_FEC</td>

                </tr>
                }
            </tbody>
        </table>


    </div>

}

<script>

    //retiene el valor para recargar los combos cuando se recarga la pagina al presionar el valor buscar.
    var cboUsu = document.getElementById("CUR_ID").value;
    var cboCur = document.getElementById("USU_ID").value;
    var cboLan = document.getElementById("LAN_ID").value;


   


    function ShowSelectedLan() {
        /* Para obtener el valor */
        //var cod = document.getElementById("LAN_ID").value;
        //alert(cod);

        /* Para obtener el texto */
        var combo = document.getElementById("LAN_ID");
        var IdLan = combo.options[combo.selectedIndex].text;
        IdLan = IdLan.slice(0, IdLan.indexOf("-")); // extraemos solo el codigo del LAN_ID.. No se me ocurrio otra forma... por ahora

        document.getElementById("IdLanzamiento").value = IdLan; //cargamos el id del lanzamiento, en la varialbe oculta...
                

    }



    var user = document.getElementById("USU_ID");
    user.onchange = function () {

        var Idusuario = document.getElementById("USU_ID").value;
        

        $.get("GetCursosByUser/?Idusuario=" + Idusuario, function (data) {
            // VACIAMOS EL DropDownList
            $("#CUR_ID").empty();
            $("#LAN_ID").empty();

            // AÑADIMOS UN NUEVO label CON EL NOMBRE DEL ELEMENTO SELECCIONADO
            //$("#LAN_ID").append("<option value> -- Seleccionar Territorios deE " + $("#LAN_ID option:selected").text() + " --</option>")
            // CONSTRUIMOS EL DropDownList A PARTIR DEL RESULTADO Json (data)
            $.each(data, function (index, row) {

                $("#CUR_ID").append("<option value=" + row.Value + ">" + row.Text + "</option>")
                

            });
        });
    }


    var curso = document.getElementById("CUR_ID");
    curso.onchange = function () {

        var Idcur = document.getElementById("CUR_ID").value;
        
        document.getElementById("IdCurso").value = Idcur;
        

        $.get("GetLanzamientosByUser/?IdCurso=" + Idcur + "&IdUser="+document.getElementById("USU_ID").value, function (data) {
            // VACIAMOS EL DropDownList
            $("#LAN_ID").empty();
            // AÑADIMOS UN NUEVO label CON EL NOMBRE DEL ELEMENTO SELECCIONADO
            // CONSTRUIMOS EL DropDownList A PARTIR DEL RESULTADO Json (data)
            $.each(data, function (index, row) {
                if (row.Value == document.getElementById("IdLanzamiento").value) {
                    $("#LAN_ID").append("<option selected value=" + row.Value + ">" + row.Text + "</option>")
                } else {
                    $("#LAN_ID").append("<option value=" + row.Value + ">" + row.Text + "</option>")
                }

                //alert(row.Value + " " + document.getElementById("IdLanzamiento").value)

                //alert(row.Value);
            });
        });
    }


    

</script>
